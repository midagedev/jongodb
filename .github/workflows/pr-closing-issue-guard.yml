name: PR Closing Issue Guard

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

permissions:
  contents: read
  pull-requests: read

jobs:
  require-closing-keyword:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR body contains closing keyword
        uses: actions/github-script@v7
        with:
          script: |
            const body = (context.payload.pull_request.body || "").trim();
            const closingPattern =
              /\b(?:close|closes|closed|fix|fixes|fixed|resolve|resolves|resolved)\b\s+(?:(?:[A-Za-z0-9_.-]+\/[A-Za-z0-9_.-]+)?#\d+)/i;

            if (!closingPattern.test(body)) {
              core.setFailed(
                [
                  "PR body must include at least one issue auto-close keyword.",
                  "Example: `Closes #48` or `Fixes midagedev/jongodb#48`.",
                ].join(" ")
              );
            }
